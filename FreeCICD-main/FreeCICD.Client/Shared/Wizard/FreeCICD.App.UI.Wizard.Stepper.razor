@* WizardStepper.razor - Numbered step circles with visual progress using Bootstrap *@

<div class="d-flex justify-content-between align-items-start bg-light rounded-3 p-3 mb-3 shadow-sm overflow-auto">
    @for (int i = 0; i < Steps.Count; i++)
    {
        var stepIndex = i;
        var step = Steps[i];
        var isCompleted = stepIndex < CurrentStep;
        var isCurrent = stepIndex == CurrentStep;
        var isClickable = isCompleted && OnStepClick.HasDelegate;

        <div class="d-flex flex-column align-items-center flex-fill position-relative" style="min-width: 70px;">
            @* Step Circle *@
            <div class="rounded-circle d-flex align-items-center justify-content-center fw-bold border border-2 @(isCompleted ? "bg-success border-success text-white" : isCurrent ? "bg-primary border-primary text-white shadow" : "bg-white border-secondary text-muted") @(isClickable ? "cursor-pointer" : "")"
                 style="width: 36px; height: 36px; z-index: 2; @(isClickable ? "cursor: pointer;" : "")"
                 @onclick="@(() => HandleStepClick(stepIndex))"
                 title="@(isClickable ? $"Go to {step.Name}" : step.Name)">
                @if (isCompleted)
                {
                    <i class="fa fa-check"></i>
                }
                else if (isCurrent)
                {
                    <i class="fa fa-circle fa-xs"></i>
                }
                else
                {
                    <span class="small">@(stepIndex + 1)</span>
                }
            </div>

            @* Connector Line *@
            @if (stepIndex < Steps.Count - 1)
            {
                <div class="position-absolute @(isCompleted ? "bg-success" : "bg-secondary")" 
                     style="height: 3px; top: 18px; left: 50%; width: 100%; z-index: 1; opacity: 0.5;"></div>
            }

            @* Step Label *@
            <div class="text-center mt-2" style="max-width: 80px;">
                <div class="small fw-semibold @(isCompleted ? "text-success" : isCurrent ? "text-primary" : "text-muted") text-truncate">
                    @step.ShortName
                </div>
                @if (!string.IsNullOrWhiteSpace(step.SelectedValue) && (isCompleted || isCurrent))
                {
                    <div class="text-muted small text-truncate" style="font-size: 0.7rem;" title="@step.SelectedValue">
                        @TruncateText(step.SelectedValue, 10)
                    </div>
                }
                else if (isCurrent)
                {
                    <div class="text-primary small fst-italic" style="font-size: 0.7rem;">(current)</div>
                }
            </div>
        </div>
    }
</div>

@code {
    [Parameter]
    public List<WizardStepInfo> Steps { get; set; } = new();

    [Parameter]
    public int CurrentStep { get; set; }

    [Parameter]
    public EventCallback<int> OnStepClick { get; set; }

    public class WizardStepInfo
    {
        public string Name { get; set; } = "";
        public string ShortName { get; set; } = "";
        public string SelectedValue { get; set; } = "";
    }

    private async Task HandleStepClick(int stepIndex)
    {
        if (stepIndex < CurrentStep && OnStepClick.HasDelegate)
        {
            await OnStepClick.InvokeAsync(stepIndex);
        }
    }

    private string TruncateText(string text, int maxLength)
    {
        if (string.IsNullOrEmpty(text)) return "";
        if (text.Length <= maxLength) return text;
        return text.Substring(0, maxLength - 2) + "..";
    }
}
